// *****************
// PROFILE SETTINGS
// control how software is used (i.e. conda, docker, etc)
// *****************

// Nextflow Autometa Pipeline Configuration.
/*
 To choose one of the available profiles (standard, cluster, chtc) you must pass
 in the the -profile argument. 
 i.e. 
 
 ```bash
 nextflow run main.nf -profile cluster -c parameters.config
 ```

 You may also specify multiple profiles by separating their names with a comma.
 i.e.
 
 ```bash
 nextflow run autometa.nf -profile standard,cluster -c parameters.config
 ```

 Note: Standard profile is implictly used if no profile is specified by the user.
*/


profiles {
  standard {
    process.executor = "local"
  }
  cluster {
    process.executor = "slurm"
    // queue is the slurm partition to use.
    // Set SLURM partition with queue directive.
    process.queue = "queue"
    // See https://www.nextflow.io/docs/latest/executor.html#slurm for details.
  }
  chtc {
    process.executor = "condor"
    // See https://www.nextflow.io/docs/latest/executor.html#htcondor for details.
    /* 
    ***IMPORTANT NOTES:***
    1. The pipeline must be launched from a node where the `condor_submit` command is available.
    2. The HTCondor executor for Nextflow does not support at this time the HTCondor 
    ability to transfer input/output data to the corresponding job computing node. 
    Therefore the data needs to be made accessible to the computing nodes using a 
    shared file system directory from where the Nextflow workflow has to be executed 
    (or specified via the -w option).
    */
  }
}




profiles {
  conda { process.conda = "$projectDir/environment.yml" } // defaults to where main nextflow script is called from
  debug { process.beforeScript = 'echo $HOSTNAME' }
  docker {
    process.container = 'jasonkwan/autometa:dev'
    docker.enabled = true
    // Avoid this error:
    //   WARNING: Your kernel does not support swap limit capabilities or the cgroup is not mounted. Memory limited without swap.
    // Testing this in nf-core after discussion here https://github.com/nf-core/tools/pull/351
    // once this is established and works well, nextflow might implement this behavior as new default.
    docker.runOptions = '-u \$(id -u):\$(id -g)'
  }
  singularity {
    singularity.enabled = true
    singularity.autoMounts = true
  }
  podman {
    podman.enabled = true
  }
  test { includeConfig 'conf/test.config' }
  test_full { includeConfig 'conf/test_full.config' }
}

