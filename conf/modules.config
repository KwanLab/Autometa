/*
========================================================================================
    Config file for defining DSL2 per module options and publishing paths
========================================================================================
    Available keys to override module options:
        ext.args            = Additional arguments appended to command in module.
        ext.args2           = Second set of arguments appended to command in module (multi-tool modules).
        ext.args3           = Third set of arguments appended to command in module (multi-tool modules).
        ext.prefix          = File name prefix for output files.
----------------------------------------------------------------------------------------
*/


process {
    withName:'ALIGN_READS'{
        publishDir = [
            path: { "${params.outdir}/${task.process.tokenize(':')[-1].toLowerCase()}" },
            mode: params.publish_dir_mode
        ]
        ext.args = ''
        ext.args2 = '-q --phred33 --very-sensitive --no-unal'
    }
    withName:'BEDTOOLS_GENOMECOV'{
        publishDir = [
            path: { "${params.outdir}/${task.process.tokenize(':')[-1].toLowerCase()}" },
            mode: params.publish_dir_mode
        ]
    }
    withName:'BINNING'{
        publishDir = [
            path: { "${params.outdir}/${task.process.tokenize(':')[-1].toLowerCase()}" },
            mode: params.publish_dir_mode
        ]
    }
    withName:'BINNING_SUMMARY'{
        publishDir = [
            path: { "${params.outdir}/${task.process.tokenize(':')[-1].toLowerCase()}" },
            mode: params.publish_dir_mode
        ]
    }
    withName:'COUNT_KMERS'{
        publishDir = [
            path: { "${params.outdir}/${task.process.tokenize(':')[-1].toLowerCase()}" },
            mode: params.publish_dir_mode
        ]
    }
    withName:'DIAMOND_BLASTP'{
        publishDir = [
            path: { "${params.outdir}/${task.process.tokenize(':')[-1].toLowerCase()}" },
            mode: params.publish_dir_mode
        ]
        ext.args = '--evalue 1e-5 --max-target-seqs 200 -b 6 --outfmt 6'
    }
    withName:'DIAMOND_MAKEDB'{
        storeDir = {"${params.nr_dmnd_dir}"}
    }
    withName:'DOWNLOAD_ACESSION2TAXID'{
        storeDir = {"${params.prot_accession2taxid_gz_dir}"}
    }
    withName:'DOWNLOAD_NR'{
        storeDir = {"${params.nr_dmnd_dir}"}
    }
    withName:'DOWNLOAD_TAXDUMP'{
        storeDir = {"${params.taxdump_tar_gz_dir}"}
    }
    withName:'EMBED_KMERS'{
        publishDir = [
            path: { "${params.outdir}/${task.process.tokenize(':')[-1].toLowerCase()}" },
            mode: params.publish_dir_mode
        ]
    }
    withName:'GET_GENOMES_FOR_MOCK'{
        storeDir = { "${params.outdir}/mock_data/genomes"}
        ext.args = 'https://ftp.ncbi.nlm.nih.gov/genomes/ASSEMBLY_REPORTS/assembly_summary_refseq.txt'
        ext.args2 = 'GCF_000734955.1|GCF_900448115.1|GCF_015751765.1'
    }
    withName:'GET_SOFTWARE_VERSIONS'{
        publishDir = [
            path: { "${params.outdir}/${task.process.tokenize(':')[-1].toLowerCase()}" },
            mode: params.publish_dir_mode
        ]
    }
    withName:'HMMER_HMMSEARCH_FILTER'{
        publishDir = [
            path: { "${params.outdir}/${task.process.tokenize(':')[-1].toLowerCase()}" },
            mode: params.publish_dir_mode
        ]
    }
    withName:'HMMER_HMMSEARCH'{
        publishDir = [
            path: { "${params.outdir}/${task.process.tokenize(':')[-1].toLowerCase()}" },
            mode: params.publish_dir_mode
        ]
        ext.args = "-Z 150 --cpu 1 --seed 42"
    }
    withName:'LENGTH_TABLE'{
        publishDir = [
            path: { "${params.outdir}/${task.process.tokenize(':')[-1].toLowerCase()}" },
            mode: params.publish_dir_mode
        ]
    }
    withName:'MAJORITY_VOTE'{
        publishDir = [
            path: { "${params.outdir}/${task.process.tokenize(':')[-1].toLowerCase()}" },
            mode: params.publish_dir_mode
        ]
    }
    withName:'MARKERS'{
        publishDir = [
            path: { "${params.outdir}/${task.process.tokenize(':')[-1].toLowerCase()}" },
            mode: params.publish_dir_mode
        ]
    }
    withName:'MERGE_FASTA'{
        publishDir = [
            path: { "${params.outdir}/${task.process.tokenize(':')[-1].toLowerCase()}" },
            mode: params.publish_dir_mode
        ]
    }
    withName:'MERGE_TSV_WITH_HEADERS'{
        publishDir = [
            path: { "${params.outdir}/${task.process.tokenize(':')[-1].toLowerCase()}" },
            mode: params.publish_dir_mode
        ]
    }
    withName:'MOCK_DATA_REPORT'{
        publishDir = [
            path: { "${params.outdir}/${task.process.tokenize(':')[-1].toLowerCase()}" },
            mode: params.publish_dir_mode
        ]
    }
    withName:'NORMALIZE_KMERS'{
        publishDir = [
            path: { "${params.outdir}/${task.process.tokenize(':')[-1].toLowerCase()}" },
            mode: params.publish_dir_mode
        ]
    }
    withName:'PARSE_BED'{
        publishDir = [
            path: { "${params.outdir}/${task.process.tokenize(':')[-1].toLowerCase()}" },
            mode: params.publish_dir_mode
        ]
    }
    withName:'PREP_DBS'{
        storeDir = {"${params.lca_dir}"}
    }
    withName:'PRODIGAL'{
        publishDir = [
            path: { "${params.outdir}/${task.process.tokenize(':')[-1].toLowerCase()}" },
            mode: params.publish_dir_mode
        ]
        ext.args = '-p meta -m'
    }
    withName:'REDUCE_LCA'{
        publishDir = [
            path: { "${params.outdir}/${task.process.tokenize(':')[-1].toLowerCase()}" },
            mode: params.publish_dir_mode
        ]
    }
    withName:'SAMPLESHEET_CHECK'{
        publishDir = [
            path: { "${params.outdir}/${task.process.tokenize(':')[-1].toLowerCase()}" },
            mode: params.publish_dir_mode
        ]
    }
    withName:'SAMTOOLS_VIEW_AND_SORT'{
        publishDir = [
            path: { "${params.outdir}/${task.process.tokenize(':')[-1].toLowerCase()}" },
            mode: params.publish_dir_mode
        ]
        ext.args = ''
        ext.args2 = ''
    }
    withName:'SEQKIT_FILTER'{
        publishDir = [
            path: { "${params.outdir}/${task.process.tokenize(':')[-1].toLowerCase()}" },
            mode: params.publish_dir_mode
        ]
    }
    withName:'SEQKIT_SPLIT'{
        publishDir = [
            path: { "${params.outdir}/${task.process.tokenize(':')[-1].toLowerCase()}" },
            mode: params.publish_dir_mode
        ]
    }
    withName:'SPADES_KMER_COVERAGE'{
        publishDir = [
            path: { "${params.outdir}/${task.process.tokenize(':')[-1].toLowerCase()}" },
            mode: params.publish_dir_mode,
            pattern: '*.coverages.tsv'
        ]
    }
    withName:'SPLIT_KINGDOMS'{
        publishDir = [
            path: { "${params.outdir}/${task.process.tokenize(':')[-1].toLowerCase()}" },
            mode: params.publish_dir_mode
        ]
    }
    withName:'RECRUIT'{
        publishDir = [
            path: { "${params.outdir}/${task.process.tokenize(':')[-1].toLowerCase()}" },
            mode: params.publish_dir_mode
        ]
    }
    withName:'TEST_DOWNLOAD'{
        storeDir = {"${params.prot_accession2taxid_gz_dir}"}
    }
}

/*

'seqkit_split_options' {
            publish_by_meta  = ['id']
            args2            = "--two-pass"
        }



*/

